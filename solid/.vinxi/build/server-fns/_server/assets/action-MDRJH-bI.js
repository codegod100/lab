import{getOwner as N,runWithOwner as ne,createMemo as b,useContext as re,createContext as oe,createSignal as A,createRenderEffect as be,on as se,startTransition as j,resetErrorBoundaries as xe,batch as Oe,untrack as Ae,createComponent as Ce,getListener as Ee,onCleanup as ae,sharedConfig as x,$TRACK as Fe}from"solid-js";import{isServer as v,getRequestEvent as C}from"solid-js/web";function Se(){let e=new Set;function t(r){return e.add(r),()=>e.delete(r)}let n=!1;function o(r,s){if(n)return!(n=!1);const i={to:r,options:s,defaultPrevented:!1,preventDefault:()=>i.defaultPrevented=!0};for(const l of e)l.listener({...i,from:l.location,retry:g=>{g&&(n=!0),l.navigate(r,{...s,resolve:!1})}});return!i.defaultPrevented}return{subscribe:t,confirm:o}}let k;function ie(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),k=window.history.state._depth}v||ie();function nt(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function rt(e,t){let n=!1;return()=>{const o=k;ie();const r=o==null?null:k-o;if(n){n=!1;return}r&&t(r)?(n=!0,window.history.go(-r)):e()}}const Le=/^(?:[a-z0-9]+:)?\/\//i,_e=/^\/+|(\/)\/+$/g,ce="http://sr";function B(e,t=!1){const n=e.replace(_e,"$1");return n?t||/^[?#]/.test(n)?n:"/"+n:""}function K(e,t,n){if(Le.test(t))return;const o=B(e),r=n&&B(n);let s="";return!r||t.startsWith("/")?s=o:r.toLowerCase().indexOf(o.toLowerCase())!==0?s=o+r:s=r,(s||"/")+B(t,!s)}function je(e,t){if(e==null)throw new Error(t);return e}function Be(e,t){return B(e).replace(/\/*(\*.*)?$/g,"")+B(t)}function ue(e){const t={};return e.searchParams.forEach((n,o)=>{o in t?Array.isArray(t[o])?t[o].push(n):t[o]=[t[o],n]:t[o]=n}),t}function $e(e,t,n){const[o,r]=e.split("/*",2),s=o.split("/").filter(Boolean),i=s.length;return l=>{const g=l.split("/").filter(Boolean),d=g.length-i;if(d<0||d>0&&r===void 0&&!t)return null;const c={path:i?"":"/",params:{}},a=p=>n===void 0?void 0:n[p];for(let p=0;p<i;p++){const f=s[p],w=f[0]===":",u=w?g[p]:g[p].toLowerCase(),y=w?f.slice(1):f.toLowerCase();if(w&&H(u,a(y)))c.params[y]=u;else if(w||!H(u,y))return null;c.path+=`/${u}`}if(r){const p=d?g.slice(-d).join("/"):"";if(H(p,a(r)))c.params[r]=p;else return null}return c}}function H(e,t){const n=o=>o===e;return t===void 0?!0:typeof t=="string"?n(t):typeof t=="function"?t(e):Array.isArray(t)?t.some(n):t instanceof RegExp?t.test(e):!1}function Me(e){const[t,n]=e.pattern.split("/*",2),o=t.split("/").filter(Boolean);return o.reduce((r,s)=>r+(s.startsWith(":")?2:3),o.length-(n===void 0?0:1))}function le(e){const t=new Map,n=N();return new Proxy({},{get(o,r){return t.has(r)||ne(n,()=>t.set(r,b(()=>e()[r]))),t.get(r)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())}})}function fe(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),o=e.slice(t.index+t[0].length);const r=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(o);)r.push(n+=t[1]),o=o.slice(t[0].length);return fe(o).reduce((s,i)=>[...s,...r.map(l=>l+i)],[])}const De=100,Ie=oe(),Te=oe(),G=()=>je(re(Ie),"<A> and 'use' router primitives can be only used inside a Route."),We=()=>G().navigatorFactory();function qe(e,t=""){const{component:n,preload:o,load:r,children:s,info:i}=e,l=!s||Array.isArray(s)&&!s.length,g={key:e,component:n,preload:o||r,info:i};return he(e.path).reduce((d,c)=>{for(const a of fe(c)){const p=Be(t,a);let f=l?p:p.split("/*",1)[0];f=f.split("/").map(w=>w.startsWith(":")||w.startsWith("*")?w:encodeURIComponent(w)).join("/"),d.push({...g,originalPath:c,pattern:f,matcher:$e(f,!l,e.matchFilters)})}return d},[])}function Ue(e,t=0){return{routes:e,score:Me(e[e.length-1])*1e4-t,matcher(n){const o=[];for(let r=e.length-1;r>=0;r--){const s=e[r],i=s.matcher(n);if(!i)return null;o.unshift({...i,route:s})}return o}}}function he(e){return Array.isArray(e)?e:[e]}function Ke(e,t="",n=[],o=[]){const r=he(e);for(let s=0,i=r.length;s<i;s++){const l=r[s];if(l&&typeof l=="object"){l.hasOwnProperty("path")||(l.path="");const g=qe(l,t);for(const d of g){n.push(d);const c=Array.isArray(l.children)&&l.children.length===0;if(l.children&&!c)Ke(l.children,d.pattern,n,o);else{const a=Ue([...n],o.length);o.push(a)}n.pop()}}}return n.length?o:o.sort((s,i)=>i.score-s.score)}function X(e,t){for(let n=0,o=e.length;n<o;n++){const r=e[n].matcher(t);if(r)return r}return[]}function He(e,t,n){const o=new URL(ce),r=b(c=>{const a=e();try{return new URL(a,o)}catch{return console.error(`Invalid path ${a}`),c}},o,{equals:(c,a)=>c.href===a.href}),s=b(()=>r().pathname),i=b(()=>r().search,!0),l=b(()=>r().hash),g=()=>"",d=se(i,()=>ue(r()));return{get pathname(){return s()},get search(){return i()},get hash(){return l()},get state(){return t()},get key(){return g()},query:n?n(d):le(d)}}let O;function Xe(){return O}let _=!1;function ke(){return _}function ot(e){_=e}function st(e,t,n,o={}){const{signal:[r,s],utils:i={}}=e,l=i.parsePath||(h=>h),g=i.renderPath||(h=>h),d=i.beforeLeave||Se(),c=K("",o.base||"");if(c===void 0)throw new Error(`${c} is not a valid base path`);c&&!r().value&&s({value:c,replace:!0,scroll:!1});const[a,p]=A(!1);let f;const w=(h,m)=>{m.value===u()&&m.state===R()||(f===void 0&&p(!0),O=h,f=m,j(()=>{f===m&&(y(f.value),I(f.state),xe(),v||J[1](P=>P.filter(E=>E.pending)))}).finally(()=>{f===m&&Oe(()=>{O=void 0,h==="navigate"&&ve(f),p(!1),f=void 0})}))},[u,y]=A(r().value),[R,I]=A(r().state),T=He(u,R,i.queryWrapper),W=[],J=A(v?Pe():[]),Y=b(()=>typeof o.transformUrl=="function"?X(t(),o.transformUrl(T.pathname)):X(t(),T.pathname)),Q=()=>{const h=Y(),m={};for(let P=0;P<h.length;P++)Object.assign(m,h[P].params);return m},me=i.paramsWrapper?i.paramsWrapper(Q,t):le(Q),V={pattern:c,path:()=>c,outlet:()=>null,resolvePath(h){return K(c,h)}};return be(se(r,h=>w("native",h),{defer:!0})),{base:V,location:T,params:me,isRouting:a,renderPath:g,parsePath:l,navigatorFactory:ye,matches:Y,beforeLeave:d,preloadRoute:Re,singleFlight:o.singleFlight===void 0?!0:o.singleFlight,submissions:J};function we(h,m,P){Ae(()=>{if(typeof m=="number"){m&&(i.go?i.go(m):console.warn("Router integration does not support relative routing"));return}const E=!m||m[0]==="?",{replace:q,resolve:F,scroll:U,state:S}={replace:!1,resolve:!E,scroll:!0,...P},L=F?h.resolvePath(m):K(E&&T.pathname||"",m);if(L===void 0)throw new Error(`Path '${m}' is not a routable path`);if(W.length>=De)throw new Error("Too many redirects");const Z=u();if(L!==Z||S!==R())if(v){const ee=C();ee&&(ee.response={status:302,headers:new Headers({Location:L})}),s({value:L,replace:q,scroll:U,state:S})}else d.confirm(L,P)&&(W.push({value:Z,replace:q,scroll:U,state:R()}),w("navigate",{value:L,state:S}))})}function ye(h){return h=h||re(Te)||V,(m,P)=>we(h,m,P)}function ve(h){const m=W[0];m&&(s({...h,replace:m.replace,scroll:m.scroll}),W.length=0)}function Re(h,m){const P=X(t(),h.pathname),E=O;O="preload";for(let q in P){const{route:F,params:U}=P[q];F.component&&F.component.preload&&F.component.preload();const{preload:S}=F;_=!0,m&&S&&ne(n(),()=>S({params:U,location:{pathname:h.pathname,search:h.search,hash:h.hash,query:ue(h),state:null,key:""},intent:"preload"})),_=!1}O=E}function Pe(){const h=C();return h&&h.router&&h.router.submission?[h.router.submission]:[]}}function at(e,t,n,o){const{base:r,location:s,params:i}=e,{pattern:l,component:g,preload:d}=o().route,c=b(()=>o().path);g&&g.preload&&g.preload(),_=!0;const a=d?d({params:i,location:s,intent:O||"initial"}):void 0;return _=!1,{parent:t,pattern:l,path:c,outlet:()=>g?Ce(g,{params:i,location:s,data:a,get children(){return n()}}):n(),resolvePath(f){return K(r.path(),f,c())}}}const ze="Location",Ne=5e3,Ge=18e4;let $=new Map;v||setInterval(()=>{const e=Date.now();for(let[t,n]of $.entries())!n[4].count&&e-n[0]>Ge&&$.delete(t)},3e5);function M(){if(!v)return $;const e=C();if(!e)throw new Error("Cannot find cache context");return(e.router||(e.router={})).cache||(e.router.cache=new Map)}function Je(e,t=!0){return j(()=>{const n=Date.now();de(e,o=>{t&&(o[0]=0),o[4][1](n)})})}function de(e,t){e&&!Array.isArray(e)&&(e=[e]);for(let n of $.keys())(e===void 0||pe(n,e))&&t($.get(n))}function D(e,t){e.GET&&(e=e.GET);const n=(...o)=>{const r=M(),s=Xe(),i=ke(),g=N()?We():void 0,d=Date.now(),c=t+z(o);let a=r.get(c),p;if(v){const u=C();if(u){const y=(u.router||(u.router={})).dataOnly;if(y){const R=u&&(u.router.data||(u.router.data={}));if(R&&c in R)return R[c];if(Array.isArray(y)&&!pe(c,y))return R[c]=void 0,Promise.resolve()}}}if(Ee()&&!v&&(p=!0,ae(()=>a[4].count--)),a&&a[0]&&(v||s==="native"||a[4].count||Date.now()-a[0]<Ne)){p&&(a[4].count++,a[4][0]()),a[3]==="preload"&&s!=="preload"&&(a[0]=d);let u=a[1];return s!=="preload"&&(u="then"in a[1]?a[1].then(w(!1),w(!0)):w(!1)(a[1]),!v&&s==="navigate"&&j(()=>a[4][1](a[0]))),i&&"then"in u&&u.catch(()=>{}),u}let f;if(!v&&x.has&&x.has(c)?(f=x.load(c),delete globalThis._$HY.r[c]):f=e(...o),a?(a[0]=d,a[1]=f,a[3]=s,!v&&s==="navigate"&&j(()=>a[4][1](a[0]))):(r.set(c,a=[d,f,,s,A(d)]),a[4].count=0),p&&(a[4].count++,a[4][0]()),v){const u=C();if(u&&u.router.dataOnly)return u.router.data[c]=f}if(s!=="preload"&&(f="then"in f?f.then(w(!1),w(!0)):w(!1)(f)),i&&"then"in f&&f.catch(()=>{}),v&&x.context&&x.context.async&&!x.context.noHydrate){const u=C();(!u||!u.serverOnly)&&x.context.serialize(c,f)}return f;function w(u){return async y=>{if(y instanceof Response){const R=y.headers.get(ze);if(R!==null){if(g&&R.startsWith("/"))j(()=>{g(R,{replace:!0})});else if(!v)window.location.href=R;else if(v){const I=C();I&&(I.response={status:302,headers:new Headers({Location:R})})}return}y.customBody&&(y=await y.customBody())}if(u)throw y;return a[2]=y,y}}};return n.keyFor=(...o)=>t+z(o),n.key=t,n}D.get=e=>M().get(e)[2];D.set=(e,t)=>{const n=M(),o=Date.now();let r=n.get(e);r?(r[0]=o,r[1]=Promise.resolve(t),r[2]=t,r[3]="preload"):(n.set(e,r=[o,Promise.resolve(t),t,"preload",A(o)]),r[4].count=0)};D.delete=e=>M().delete(e);D.clear=()=>M().clear();function pe(e,t){for(let n of t)if(n&&e.startsWith(n))return!0;return!1}function z(e){return JSON.stringify(e,(t,n)=>Ye(n)?Object.keys(n).sort().reduce((o,r)=>(o[r]=n[r],o),{}):n)}function Ye(e){let t;return e!=null&&typeof e=="object"&&(!(t=Object.getPrototypeOf(e))||t===Object.prototype)}const te=new Map;function Qe(e,t){const n=G(),o=b(()=>n.submissions[0]().filter(r=>r.url===e.base&&!0));return new Proxy([],{get(r,s){return s===Fe?o():s==="pending"?o().some(i=>!i.result):o()[s]},has(r,s){return s in o()}})}function it(e,t){const n=Qe(e);return new Proxy({},{get(o,r){return n.length===0&&r==="clear"||r==="retry"?()=>{}:n[n.length-1]?.[r]}})}function ct(e){const t=G();return(...n)=>e.apply({r:t},n)}function ut(e,t={}){function n(...s){const i=this.r,l=this.f,g=(i.singleFlight&&e.withOptions?e.withOptions({headers:{"X-Single-Flight":"true"}}):e)(...s),[d,c]=A();let a;function p(f){return async w=>{const u=await Ze(w,f,i.navigatorFactory());let y=null;if(o.onComplete?.({...a,result:u?.data,error:u?.error,pending:!1,retry(){return y=a.retry()}}),y)return y;if(!u)return a.clear();if(c(u),u.error&&!l)throw u.error;return u.data}}return i.submissions[1](f=>[...f,a={input:s,url:r,get result(){return d()?.data},get error(){return d()?.error},get pending(){return!d()},clear(){i.submissions[1](w=>w.filter(u=>u!==a))},retry(){return c(void 0),e(...s).then(p(),p(!0))}}]),g.then(p(),p(!0))}const o=typeof t=="string"?{name:t}:t,r=e.url||o.name&&`https://action/${o.name}`||(v?"":`https://action/${Ve(e.toString())}`);return n.base=r,ge(n,r)}function ge(e,t){return e.toString=()=>{if(!t)throw new Error("Client Actions need explicit names if server rendered");return t},e.with=function(...n){const o=function(...s){return e.call(this,...n,...s)};o.base=e.base;const r=new URL(t,ce);return r.searchParams.set("args",z(n)),ge(o,(r.origin==="https://action"?r.origin:"")+r.pathname+r.search)},e.url=t,v||(te.set(t,e),N()&&ae(()=>te.delete(t))),e}const Ve=e=>e.split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0)|0,0);async function Ze(e,t,n){let o,r,s,i;if(e instanceof Response){if(e.headers.has("X-Revalidate")&&(s=e.headers.get("X-Revalidate").split(",")),e.customBody&&(o=r=await e.customBody(),e.headers.has("X-Single-Flight")&&(o=o._$value,delete r._$value,i=Object.keys(r))),e.headers.has("Location")){const l=e.headers.get("Location")||"/";l.startsWith("http")?window.location.href=l:n(l)}}else{if(t)return{error:e};o=e}return de(s,l=>l[0]=0),i&&i.forEach(l=>D.set(l,r[l])),await Je(s,!1),o!=null?{data:o}:void 0}export{Ie as R,ut as a,it as b,Ke as c,st as d,at as e,X as f,Xe as g,Te as h,te as i,Se as j,nt as k,ie as l,ce as m,rt as n,ot as s,ct as u};
